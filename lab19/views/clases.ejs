<%- include('includes/head.ejs', {
    username: username,
    permisos: permisos,
}) %>
<!DOCTYPE html>
<html lang="es">
<head>
    <title>JOYERIA</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100">
    <h1 class="text-center text-blue-900 italic text-3xl py-6 hover:text-red-500 hover:text-4xl">
        Joyas
    </h1>

    <!-- Inicio del bucle de filas -->
    <% Array.from({ length: Math.ceil(joyeria.length / 3) }, (_, i) => { %>
        <ul class="flex justify-center gap-8 my-12">
            <!-- Inicio del bucle de artículos por fila -->
            <% joyeria.slice(i * 3, (i + 1) * 3).forEach(item => { %>
                <li class="py-6 px-8 bg-white shadow-md">
                    <div class="text-center">
                        <p class="text-lg"><a href="/joya/<%= item.id %>" class="text-blue-500 hover:text-blue-700"><%= item.nombre %></a></p>
                        <img src="<%= item.imagen %>" alt="<%= item.nombre %>" class="mt-4 mx-auto w-48 h-48 object-cover rounded-full">
                        <p class="text-gray-700 mt-4"><%= item.descripcion %></p>
                        <p class="text-gray-700 mt-2"><%= item.precio %></p>
                        <button class="mt-4 bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-full">Comprar</button>
                        
                        <!-- Verificación de permisos para editar joyas -->
                        <!-- <% for (let permiso of permisos) { %>
                            <% if(permiso.permiso == 'editar_joya') { %>
                                <a href="/joyas/editar/<%= item.id %>" class="mt-2 text-blue-500 hover:text-blue-700">Editar</a>
                            <% } %>
                        <% } %> -->
                    </div>
                </li>
            <% }); %>
            <!-- Fin del bucle de artículos por fila -->
        </ul>
    <% }); %>
    <!-- Fin del bucle de filas -->

    <% if(ultima_joya != '') { %> 
        <div>La joya creada fue <%= ultima_joya %>.</div>
    <% } %>
</body>

<div id="spotifyPlaylist">
    <script>
        
        const playlistId = '0v4vTwebMBgz0ih46nysbr';
       
        const token = 'a998e1504f3a4160b863866e6559254b';

        fetch(`https://api.spotify.com/v1/playlists/${playlistId}`, {
          headers: {
            'Authorization': 'Bearer ${token}',
          }
        })
        .then(response => response.json())
        .then(data => {
          const playlist = data;
          const playlistEmbedUrl = `https://open.spotify.com/embed/playlist/${playlistId}`
          // Crea el cuadro donde estará la playlist
          const iframe = document.createElement('iframe');
          iframe.src = playlistEmbedUrl;
          iframe.title = 'Spotify Embed: Recommendation Playlist';
          iframe.width = '100%';
          iframe.height = '100%';
          iframe.style.minHeight = '360px';
          iframe.frameBorder = '0';
          iframe.allow = 'autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture';
          iframe.loading = 'lazy';
    
          document.getElementById('spotifyPlaylist').appendChild(iframe);
        })
        .catch(error => console.error('Error:', error));

    </script>
</div>
</html>